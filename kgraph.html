<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KG & LLM Writing Assessment Simulation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is structured as a linear, step-by-step interactive simulation to guide the user through a complex process. This task-oriented flow (1. Input -> 2. KG Construction -> 3. Analysis) was chosen over a dashboard because it's more educational for demonstrating a workflow. The user actively triggers each stage, making the cause-and-effect relationship between the essay's content, the knowledge graph's structure, and the final analytical scores clear and intuitive. This enhances understanding of how the technology works. -->
    <!-- Visualization & Content Choices: 
        1. Essay Text -> Goal: Provide input -> Presentation: Styled HTML text block -> Interaction: User reads and clicks 'Analyze' button -> Justification: Sets the stage and provides the source material for the simulation.
        2. Argument Structure (Claims, Evidence, Relations) -> Goal: Organize & show relationships -> Viz: Interactive Knowledge Graph on HTML Canvas -> Interaction: Nodes and edges animate into a force-directed layout. Hovering on a node highlights it and its connections, showing its text. -> Justification: A dynamic graph is the most direct and intuitive way to represent the "knowledge graph" concept, far superior to a static image. The custom canvas implementation avoids SVG/Mermaid as required and provides full control over the interactive experience.
        3. Argument Strength Scores -> Goal: Compare -> Viz: Bar Chart -> Interaction: Hover tooltips show precise scores -> Justification: Chart.js provides a clean, standard, and easily understood visualization for comparing the calculated strength of different arguments.
        4. Coherence & Evidence Scores -> Goal: Inform -> Viz: Styled HTML elements (progress bar for coherence, table for evidence) -> Interaction: N/A (display only) -> Justification: These are summary metrics that are best presented simply and clearly without complex visualization, avoiding clutter.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .step-card {
            transition: all 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .step-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-800">Knowledge Graph & LLM   </h1>
            <p class="mt-2 text-lg text-stone-600">A simulation of how Knowledge Graphs and LLMs analyze argumentative writing.</p>
        </header>

        <main class="space-y-12">
            
            <section id="step1" class="step-card visible bg-white p-6 rounded-xl shadow-md border border-stone-200">
                <div class="flex items-center mb-4">
                    <div class="bg-sky-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg">1</div>
                    <h2 class="text-2xl font-bold ml-4 text-stone-700">The Student Essay</h2>
                </div>
                <p class="mb-4 text-stone-600">This section contains the sample essay to be analyzed. The system will deconstruct this text to identify the core claims, supporting evidence, and the main thesis. Click the button below to begin the analysis.</p>
                <div id="essayContainer" class="bg-stone-100 p-4 rounded-lg border border-stone-200 text-stone-700 space-y-3">
                    <h3 class="font-bold text-center">The Urgency of Renewable Energy Adoption</h3>
                    <p><span class="font-semibold" data-entity-id="0">[Thesis]</span> To mitigate the severe impacts of climate change, a global transition to renewable energy sources is not just beneficial, but imperative.</p>
                    <p><span class="font-semibold" data-entity-id="1">[Claim]</span> The primary driver of climate change is the emission of greenhouse gases from burning fossil fuels.</p>
                    <p><span class="font-semibold" data-entity-id="2">[Evidence]</span> The IPCC has reported that fossil fuels are responsible for over 75% of global greenhouse gas emissions.</p>
                    <p><span class="font-semibold" data-entity-id="3">[Claim]</span> Renewable energy sources like solar and wind produce little to no greenhouse gas emissions.</p>
                    <p><span class="font-semibold" data-entity-id="4">[Evidence]</span> According to the National Renewable Energy Laboratory, wind turbines have a carbon footprint 99% less than coal-fired power plants.</p>
                    <p><span class="font-semibold" data-entity-id="5">[Counter-Claim]</span> Some argue that renewable energy is unreliable due to its intermittent nature.</p>
                     <p><span class="font-semibold" data-entity-id="6">[Rebuttal]</span> However, advancements in battery storage technology and grid management are effectively solving these intermittency issues.</p>
                </div>
                <div class="text-center mt-6">
                    <button id="analyzeBtn" class="bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors shadow">
                        Analyze Essay
                    </button>
                </div>
            </section>

            <section id="step2" class="step-card bg-white p-6 rounded-xl shadow-md border border-stone-200">
                <div class="flex items-center mb-4">
                    <div class="bg-sky-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg">2</div>
                    <h2 class="text-2xl font-bold ml-4 text-stone-700">Argument Knowledge Graph</h2>
                </div>
                <p class="mb-4 text-stone-600">The system now constructs a Knowledge Graph to map the essay's argumentative structure. Nodes represent concepts (Thesis, Claims, Evidence), and edges show their logical relationships. Hover over a node to see its text and highlight connections. This visualization reveals the logical flow and foundation of the author's argument.</p>
                <div id="graph-container" class="w-full h-[500px] bg-stone-100 rounded-lg border border-stone-200 relative">
                     <canvas id="knowledgeGraph"></canvas>
                     <div id="tooltip" class="absolute bg-black bg-opacity-75 text-white text-sm rounded-md p-2 pointer-events-none opacity-0 transition-opacity"></div>
                </div>
                <div id="legend" class="flex justify-center items-center space-x-4 mt-4 text-sm text-stone-600 flex-wrap">
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-sky-500 mr-2"></span>Thesis</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-teal-500 mr-2"></span>Claim</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-amber-500 mr-2"></span>Evidence</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-gray-500 mr-2"></span>Counter-Claim</div>
                    <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-indigo-500 mr-2"></span>Rebuttal</div>
                </div>
            </section>

            <section id="step3" class="step-card bg-white p-6 rounded-xl shadow-md border border-stone-200">
                <div class="flex items-center mb-4">
                    <div class="bg-sky-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold text-lg">3</div>
                    <h2 class="text-2xl font-bold ml-4 text-stone-700">Deeper Analysis & Scoring</h2>
                </div>
                <p class="mb-6 text-stone-600">By analyzing the Knowledge Graph's structure and content, the system provides scores for key writing attributes. This goes beyond grammar to assess the quality of the argumentation itself, providing specific, actionable feedback.</p>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-3 text-center text-stone-700">Argument Strength</h3>
                        <p class="text-sm text-stone-600 mb-4 text-center">Measures how well each claim is supported by evidence. A higher bar indicates stronger support within the essay's structure.</p>
                        <div class="chart-container">
                            <canvas id="strengthChart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-8">
                         <div>
                            <h3 class="text-xl font-semibold mb-3 text-stone-700">Coherence</h3>
                            <p class="text-sm text-stone-600 mb-2">Measures how well all parts of the essay connect to the central thesis. A higher score indicates a more unified argument.</p>
                            <div class="w-full bg-stone-200 rounded-full h-6">
                                <div id="coherenceBar" class="bg-teal-500 h-6 rounded-full text-center text-white font-medium flex items-center justify-center transition-all duration-1000" style="width: 0%;">0%</div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold mb-3 text-stone-700">Evidence Verification</h3>
                            <p class="text-sm text-stone-600 mb-2">Checks provided evidence against an external knowledge base to assess its validity.</p>
                            <div class="overflow-x-auto">
                                <table id="evidenceTable" class="w-full text-sm text-left text-stone-600">
                                    <thead class="text-xs text-stone-700 uppercase bg-stone-100">
                                        <tr>
                                            <th scope="col" class="px-4 py-2">Evidence Statement</th>
                                            <th scope="col" class="px-4 py-2">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    
    const analyzeBtn = document.getElementById('analyzeBtn');
    const sections = {
        step2: document.getElementById('step2'),
        step3: document.getElementById('step3'),
    };

    const canvas = document.getElementById('knowledgeGraph');
    const tooltip = document.getElementById('tooltip');
    const ctx = canvas.getContext('2d');
    let animationFrameId;

    const essayData = {
        entities: [
            { id: 0, text: "To mitigate... a global transition to renewable energy... is imperative.", type: 'Thesis' },
            { id: 1, text: "The primary driver of climate change is... burning fossil fuels.", type: 'Claim' },
            { id: 2, text: "The IPCC has reported... over 75% of global greenhouse gas emissions.", type: 'Evidence' },
            { id: 3, text: "Renewable energy sources... produce little to no greenhouse gas emissions.", type: 'Claim' },
            { id: 4, text: "NREL: wind turbines have a carbon footprint 99% less than coal.", type: 'Evidence' },
            { id: 5, text: "Some argue that renewable energy is unreliable...", type: 'Counter-Claim' },
            { id: 6, text: "Advancements in battery storage... are solving these issues.", type: 'Rebuttal' },
        ],
        relations: [
            { source: 1, target: 0, label: 'supports' },
            { source: 3, target: 0, label: 'supports' },
            { source: 2, target: 1, label: 'provides_evidence_for' },
            { source: 4, target: 3, label: 'provides_evidence_for' },
            { source: 5, target: 3, label: 'challenges' },
            { source: 6, target: 5, label: 'rebuts' },
        ],
        knowledgeBase: {
            2: { status: 'Verified', source: 'IPCC AR6 Report' },
            4: { status: 'Verified', source: 'NREL Life Cycle Assessment' },
        }
    };

    const colors = {
        'Thesis': '#38bdf8', // sky-500
        'Claim': '#14b8a6', // teal-500
        'Evidence': '#f59e0b', // amber-500
        'Counter-Claim': '#6b7280', // gray-500
        'Rebuttal': '#6366f1', // indigo-500
        'Verified': '#22c55e',
        'Unverified': '#ef4444',
    };

    let nodes = [];
    let edges = [];
    let strengthChart;
    let iterations = 0;

    const initSimulation = () => {
        analyzeBtn.textContent = 'Analyzing...';
        analyzeBtn.disabled = true;

        setTimeout(() => {
            sections.step2.classList.add('visible');
            initGraph();
        }, 500);

        setTimeout(() => {
            sections.step3.classList.add('visible');
            runAnalysis();
            analyzeBtn.textContent = 'Analysis Complete';
        }, 2500); 
    };

    const resizeCanvas = () => {
        const container = document.getElementById('graph-container');
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    };

    const initGraph = () => {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        iterations = 0;
        
        nodes = essayData.entities.map(e => ({
            ...e,
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: 0,
            vy: 0,
            radius: e.type === 'Thesis' ? 20 : 15
        }));

        edges = essayData.relations.map(r => ({
            source: nodes.find(n => n.id === r.source),
            target: nodes.find(n => n.id === r.target),
            label: r.label,
        }));
        
        if (animationFrameId) cancelAnimationFrame(animationFrameId);
        runForceLayout();
    };

    const runForceLayout = () => {
        const attraction = 0.02;
        const repulsion = 1000;
        const damping = 0.95;
        const maxIterations = 200;

        function update() {
            if (iterations > maxIterations) {
                drawGraph(); 
                return;
            }
            
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    const nodeA = nodes[i];
                    const nodeB = nodes[j];
                    const dx = nodeB.x - nodeA.x;
                    const dy = nodeB.y - nodeA.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance === 0) distance = 0.1;
                    
                    const force = repulsion / (distance * distance);
                    nodeA.vx -= force * (dx / distance);
                    nodeA.vy -= force * (dy / distance);
                    nodeB.vx += force * (dx / distance);
                    nodeB.vy += force * (dy / distance);
                }
            }

            edges.forEach(edge => {
                const dx = edge.target.x - edge.source.x;
                const dy = edge.target.y - edge.source.y;
                edge.source.vx += dx * attraction;
                edge.source.vy += dy * attraction;
                edge.target.vx -= dx * attraction;
                edge.target.vy -= dy * attraction;
            });

            nodes.forEach(node => {
                node.vx *= damping;
                node.vy *= damping;
                node.x += node.vx;
                node.y += node.vy;

                node.x = Math.max(node.radius, Math.min(canvas.width - node.radius, node.x));
                node.y = Math.max(node.radius, Math.min(canvas.height - node.radius, node.y));
            });

            drawGraph();
            iterations++;
            animationFrameId = requestAnimationFrame(update);
        }
        update();
    };
    
    let hoveredNode = null;

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        let foundNode = null;
        for (const node of nodes) {
            const dx = node.x - mouseX;
            const dy = node.y - mouseY;
            if (dx * dx + dy * dy < node.radius * node.radius) {
                foundNode = node;
                break;
            }
        }
        
        if (hoveredNode !== foundNode) {
            hoveredNode = foundNode;
            if (hoveredNode) {
                tooltip.style.opacity = '1';
                tooltip.style.left = `${e.clientX - rect.left + 15}px`;
                tooltip.style.top = `${e.clientY - rect.top + 15}px`;
                tooltip.textContent = `${hoveredNode.type}: ${hoveredNode.text}`;
            } else {
                tooltip.style.opacity = '0';
            }
            if(!animationFrameId || iterations > 200) drawGraph();
        }
    });

    canvas.addEventListener('mouseout', () => {
        if(hoveredNode) {
            hoveredNode = null;
            tooltip.style.opacity = '0';
            if(!animationFrameId || iterations > 200) drawGraph();
        }
    });

    function drawGraph() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const connectedNodeIds = new Set();
        if (hoveredNode) {
            connectedNodeIds.add(hoveredNode.id);
            edges.forEach(edge => {
                if (edge.source.id === hoveredNode.id) connectedNodeIds.add(edge.target.id);
                if (edge.target.id === hoveredNode.id) connectedNodeIds.add(edge.source.id);
            });
        }
        
        edges.forEach(edge => {
            const isHighlighted = hoveredNode && (edge.source.id === hoveredNode.id || edge.target.id === hoveredNode.id);
            ctx.beginPath();
            ctx.moveTo(edge.source.x, edge.source.y);
            ctx.lineTo(edge.target.x, edge.target.y);
            ctx.strokeStyle = isHighlighted ? '#0284c7' : '#94a3b8'; // sky-700, slate-400
            ctx.lineWidth = isHighlighted ? 2.5 : 1;
            ctx.stroke();
        });

        nodes.forEach(node => {
            const isDimmed = hoveredNode && !connectedNodeIds.has(node.id);
            ctx.beginPath();
            ctx.arc(node.x, node.y, node.radius, 0, 2 * Math.PI);
            ctx.fillStyle = colors[node.type];
            ctx.globalAlpha = isDimmed ? 0.3 : 1.0;
            ctx.fill();

            if (node.status) {
                ctx.strokeStyle = colors[node.status];
                ctx.lineWidth = 3;
                ctx.stroke();
            } else {
                 ctx.strokeStyle = '#e2e8f0'; // slate-200
                 ctx.lineWidth = 2;
                 ctx.stroke();
            }
        });
        ctx.globalAlpha = 1.0;
    }
    
    const runAnalysis = () => {
        const claims = essayData.entities.filter(e => e.type === 'Claim');
        const strengthScores = claims.map(claim => {
            const evidenceCount = essayData.relations.filter(r => r.source_type === 'Evidence' || (r.target === claim.id && essayData.entities.find(e => e.id === r.source)?.type === 'Evidence')).length;
            const supportCount = essayData.relations.filter(r => r.target === claim.id).length;
            return {
                label: `Claim: "${claim.text.substring(0, 20)}..."`,
                score: (evidenceCount * 5) + (supportCount * 2) 
            };
        });

        const coherenceScore = calculateCoherence();
        const coherenceBar = document.getElementById('coherenceBar');
        coherenceBar.style.width = `${coherenceScore}%`;
        coherenceBar.textContent = `${coherenceScore}%`;

        populateEvidenceTable();
        renderStrengthChart(strengthScores);
    };

    function calculateCoherence() {
        const thesis = nodes.find(n => n.type === 'Thesis');
        if (!thesis) return 0;
        let connectedCount = 0;
        const visited = new Set();
        const queue = [thesis];
        visited.add(thesis.id);

        while (queue.length > 0) {
            const currentNode = queue.shift();
            connectedCount++;
            edges.forEach(edge => {
                if (edge.source.id === currentNode.id && !visited.has(edge.target.id)) {
                    visited.add(edge.target.id);
                    queue.push(edge.target);
                }
                if (edge.target.id === currentNode.id && !visited.has(edge.source.id)) {
                    visited.add(edge.source.id);
                    queue.push(edge.source);
                }
            });
        }
        return Math.round((connectedCount / nodes.length) * 100);
    }
    
    function populateEvidenceTable() {
        const tableBody = document.querySelector('#evidenceTable tbody');
        tableBody.innerHTML = '';
        const evidenceEntities = essayData.entities.filter(e => e.type === 'Evidence');

        evidenceEntities.forEach(evidence => {
            const verification = essayData.knowledgeBase[evidence.id];
            const status = verification ? verification.status : 'Unverified';
            const statusColor = status === 'Verified' ? 'text-green-600' : 'text-red-600';

            const row = document.createElement('tr');
            row.className = 'bg-white border-b';
            row.innerHTML = `
                <td class="px-4 py-3">${evidence.text}</td>
                <td class="px-4 py-3 font-semibold ${statusColor}">${status}</td>
            `;
            tableBody.appendChild(row);

            const node = nodes.find(n => n.id === evidence.id);
            if (node) {
                node.status = status;
            }
        });
    }

    function renderStrengthChart(scores) {
        const ctx = document.getElementById('strengthChart').getContext('2d');
        if(strengthChart) strengthChart.destroy();
        strengthChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: scores.map(s => s.label),
                datasets: [{
                    label: 'Strength Score',
                    data: scores.map(s => s.score),
                    backgroundColor: '#14b8a6', // teal-500
                    borderColor: '#0f766e', // teal-700
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                           color: '#e5e7eb'
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return context[0].label.split('"')[1];
                            }
                        }
                    }
                }
            }
        });
    }

    analyzeBtn.addEventListener('click', initSimulation);
});
</script>
</body>
</html>
